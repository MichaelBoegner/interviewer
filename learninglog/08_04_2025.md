# Learning Log

## ðŸ¤” Discovery of the Day

While writing the `AppendConversation_isFinished` integration test, I ran into a subtle issue with how test case factories were being evaluated. I was using method calls like `conversationBuilder.NewIsFinishedConversationMock()` inside the test case struct, but Go evaluates those expressions immediately when the test table is declared, not lazily at test execution time. As a result, the builder was being prematurely mutated all the way to its `isFinished` state, causing incorrect test expectations. 

### âœ… Learnings

1. Solution was to write a closure returning an anonymous func that would defer execution of the given conversation build until test time. This required an additional TestCase field and some basic conditional logic to pull the tc.respBodyFunc vs the tc.respBody as needed.  

2. Closures in Go capture variables by reference, which was a great thing to learn in my case, as a pure value capture would have forced me to find another solution and maybe abandon my method approach altogether. 

3. This all also meant that I had to be sure that the returned func only got called once during the test cases, so still not perfect if I needed to call it multiple times for some reason. 
